<!DOCTYPE html>
<html lang="en">
    <head>
        <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <title>Model Components | Fluid Infusion</title>
        <link rel="stylesheet" href="../css/normalize.css">
        <link rel="stylesheet" href="../css/foundation.css">
        <link rel="stylesheet" href="../css/highlightjs-custom.css">
        <link rel="stylesheet" href="../css/octicons.css">
        <link rel="stylesheet" type="text/css" href="../lib/infusion/src/framework/preferences/css/Enactors.css" />
        <link rel="stylesheet" type="text/css" href="../lib/infusion/src/framework/preferences/css/PrefsEditor.css" />
        <link rel="stylesheet" type="text/css" href="../lib/infusion/src/framework/preferences/css/SeparatedPanelPrefsEditor.css" />
        <link rel="stylesheet" href="../css/infusion-docs.css">

        <link rel="icon" type="image/png" href="../images/favico.png">

        <script type="text/javascript" src="../lib/infusion/infusion-uiOptions.js"></script>
        <script type="text/javascript" src="../js/infusion-docs.js"></script>

    </head>
    <body class="infusion-docs fl-theme-prefsEditor-default">

        <div class="container infusion-docs-container">

            <!-- Skip Link -->
            <div id="skip">
                <a href="#tableOfContents">Jump to Table of Contents</a>
                <a href="#content">Skip to Content</a>
            </div>
            <!-- END skip link -->

            <!-- BEGIN markup for Preference Editor -->
            <div class="flc-prefsEditor-separatedPanel fl-prefsEditor-separatedPanel">
                <!-- This is the div that will contain the Preference Editor component -->
                <div class="flc-slidingPanel-panel flc-prefsEditor-iframe"></div>

                <!-- This div is for the sliding panel that shows and hides the Preference Editor controls -->
                <div class="fl-panelBar">
                    <span class="fl-prefsEditor-buttons">
                        <button id="reset" class="flc-prefsEditor-reset fl-prefsEditor-reset"><span class="fl-icon-undo"></span> Reset</button>
                        <button id="show-hide" class="flc-slidingPanel-toggleButton fl-prefsEditor-showHide">+ Show Display Preferences</button>
                    </span>
                </div>
            </div>

            <script type="text/javascript">
                fluid.uiOptions.prefsEditor(".flc-prefsEditor-separatedPanel", {
                    terms: {
                        "templatePrefix": "../lib/infusion/src/framework/preferences/html",
                        "messagePrefix": "../lib/infusion/src/framework/preferences/messages"
                    },
                    "tocTemplate": "../lib/infusion/src/components/tableOfContents/html/TableOfContents.html"
                });
            </script>

            <!-- END markup for Preference Editor -->

            <header class="row infusion-docs-header">
                <div class="infusion-docs-fluidLogo small-12 medium-3 column">
                    <a class="infusion-docs-fluidLogoText" href="../index.html" title="Infusion">infusion</a>
                </div>

                <nav class="infusion-docs-fluidCategories small-12 medium-9 column">
                    
                    
                        
                            <a href="../index.html" title="Infusion">Infusion</a>
                        
                    
                        
                            <a href="../index-tutorials.html" title="Tutorials" class="infusion-docs-category-active">Tutorials</a>
                        
                    
                        
                            <a href="../index-components.html" title="Components">Components</a>
                        
                    
                </nav>
            </header>

            <div class="infusion-docs-mainBody">
                <nav id="tableOfContents" class="infusion-docs-TOC small-12 medium-3 column" tabindex="-1">
                    
                        
                        
                    
                        
                        
                            <span class="infusion-docs-category">Tutorials</span>
                            
                                <span class="infusion-docs-sectionName">Developer Introduction to the Infusion Framework</span>
                                <ul>
                                    
                                        <li>
                                            
                                                <a href="../tutorial-developerIntroduction/DeveloperIntroductionToInfusionFramework-OpeningRemarks.html"><span class="infusion-docs-TOC-pageName">Opening Remarks</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="../tutorial-developerIntroduction/DeveloperIntroductionToInfusionFramework-Components.html"><span class="infusion-docs-TOC-pageName">Components</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="../tutorial-developerIntroduction/DeveloperIntroductionToInfusionFramework-Invokers.html"><span class="infusion-docs-TOC-pageName">Invokers</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="../tutorial-developerIntroduction/DeveloperIntroductionToInfusionFramework-EventsAndInversionOfControl.html"><span class="infusion-docs-TOC-pageName">Events and Inversion of Control</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="../tutorial-developerIntroduction/DeveloperIntroductionToInfusionFramework-ModelsAndModelComponents.html"><span class="infusion-docs-TOC-pageName">Models and Model Components</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="../tutorial-developerIntroduction/DeveloperIntroductionToInfusionFramework-ViewsAndViewComponents.html"><span class="infusion-docs-TOC-pageName">Views and View Components</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="../tutorial-developerIntroduction/DeveloperIntroductionToInfusionFramework-SubcomponentsAndModelRelaying.html"><span class="infusion-docs-TOC-pageName">Subcomponents and Model Relaying</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="../tutorial-developerIntroduction/DeveloperIntroductionToInfusionFramework-RestructuringComponents.html"><span class="infusion-docs-TOC-pageName">Restructuring Components</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="../tutorial-developerIntroduction/DeveloperIntroductionToInfusionFramework-OverridingInvokersAndRefactoring.html"><span class="infusion-docs-TOC-pageName">Overriding Invokers and Refactoring</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="../tutorial-developerIntroduction/DeveloperIntroductionToInfusionFramework-ExtendingDesignsWithExistingComponents.html"><span class="infusion-docs-TOC-pageName">Extending Designs with Existing Components</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="../tutorial-developerIntroduction/DeveloperIntroductionToInfusionFramework-TransformingModelRelays.html"><span class="infusion-docs-TOC-pageName">Transforming Model Relays</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="../tutorial-developerIntroduction/DeveloperIntroductionToInfusionFramework-ConcludingRemarks.html"><span class="infusion-docs-TOC-pageName">Concluding Remarks</span></a>
                                            
                                        </li>
                                    
                                </ul>
                            
                                <span class="infusion-docs-sectionName">Getting Started with Infusion Component Design</span>
                                <ul>
                                    
                                        <li>
                                            
                                                <a href="GettingStartedWithInfusion.html"><span class="infusion-docs-TOC-pageName">Getting Started with Infusion Component Design</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="SetUpYourEnvironment.html"><span class="infusion-docs-TOC-pageName">Set up your environment</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="DefineANamespaceAndCreateAClosure.html"><span class="infusion-docs-TOC-pageName">Define a namespace and create a closure</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="PickAComponentType.html"><span class="infusion-docs-TOC-pageName">Pick a component type</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="BasicComponentCreation-Components.html"><span class="infusion-docs-TOC-pageName">Basic Component Creation</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <span class="infusion-docs-TOC-pageName">Model Components</span>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="ViewComponents.html"><span class="infusion-docs-TOC-pageName">View Components</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="RendererComponents.html"><span class="infusion-docs-TOC-pageName">Renderer Components</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="Subcomponents.html"><span class="infusion-docs-TOC-pageName">Subcomponents</span></a>
                                            
                                        </li>
                                    
                                </ul>
                            
                                <span class="infusion-docs-sectionName">General</span>
                                <ul>
                                    
                                        <li>
                                            
                                                <a href="../tutorial-usingStringTemplates/UsingStringTemplates.html"><span class="infusion-docs-TOC-pageName">Using String Templates</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="../tutorial-iconFonts/HowToCreateAndUseFontIcons.html"><span class="infusion-docs-TOC-pageName">How to Create and Use Font Icons</span></a>
                                            
                                        </li>
                                    
                                </ul>
                            
                                <span class="infusion-docs-sectionName">Preferences Framework</span>
                                <ul>
                                    
                                        <li>
                                            
                                                <a href="../tutorial-prefsFramework/CreatingAPrefsEditor.html"><span class="infusion-docs-TOC-pageName">Creating a Preference Editor</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="../tutorial-prefsFramework/CreatingEnactors.html"><span class="infusion-docs-TOC-pageName">Creating Enactors</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="../tutorial-prefsFramework/InstantiatingTheEnhancerAndSettingsStoreOnly.html"><span class="infusion-docs-TOC-pageName">Instantiating the Enhancer and Settings Store Only</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="../tutorial-prefsFramework/StylingThePreferencesEditor.html"><span class="infusion-docs-TOC-pageName">Styling the Preferences Editor</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="../to-do/AddingPrefsEditorToSite.html"><span class="infusion-docs-TOC-pageName">Adding a Basic Preferences Editor to a Site</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="../to-do/WorkingWithPrefsEditorOnSite.html"><span class="infusion-docs-TOC-pageName">Working With A Preferences Editor On Your Site</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="../tutorial-prefsFramework/CreatingANewAdjusterUI.html"><span class="infusion-docs-TOC-pageName">Creating a New Adjuster UI</span></a>
                                            
                                        </li>
                                    
                                        <li>
                                            
                                                <a href="../tutorial-prefsFrameworkMinimalFootprint/MinimalFootprint.html"><span class="infusion-docs-TOC-pageName">Minimal Footprint</span></a>
                                            
                                        </li>
                                    
                                </ul>
                            
                                <span class="infusion-docs-sectionName">User Interface Options</span>
                                <ul>
                                    
                                        <li>
                                            
                                                <a href="../tutorial-userInterfaceOptions/UserInterfaceOptions.html"><span class="infusion-docs-TOC-pageName">User Interface Options</span></a>
                                            
                                        </li>
                                    
                                </ul>
                            
                        
                    
                        
                        
                    
                </nav>

                <article id="content" class="infusion-docs-mainContent small-12 medium-9 column" tabindex="-1">
                    <div class="infusion-docs-articleContainer">

                        <div class="flc-toc-tocContainer infusion-docs-toc"> </div>

                        <h1>Model Components</h1>

                        <p class="infusion-docs-githubLink"><a href="https://github.com/fluid-project/infusion-docs/blob/master/src/documents/tutorial-gettingStartedWithInfusion/ModelComponents.md" target="_blank">Edit on GitHub</a></p>

                        

                        <div class="infusion-docs-articleBody">
                            <hr>
<p>Part of the <a href="GettingStartedWithInfusion.html">Getting Started with Infusion Component Design Tutorial</a></p>
<hr>
<p>Many components manage an internal <a href="../FrameworkConcepts.html#model-objects">model</a>. For example:</p>
<ul>
<li>the Infusion <a href="../to-do/Pager.html">Pager</a> component, which allows users to break up long lists of items into separate pages, maintains a model including what the current page is, how many items are shown per page, how the list is sorted, etc.</li>
<li>the Infusion <a href="../to-do/UserInterfaceOptions.html">UI Options</a> component uses a slider that maintains a model including the minimum and maximum values and the current setting</li>
</ul>
<p>The Infusion Framework provides supports for model-bearing components. When you declare a component to be a <strong>model component</strong>, the Framework will automatically construct a ChangeApplier, which wraps the model with special functions that can be used to query and modify the model. The <a href="../ChangeApplier.html">ChangeApplier</a> helps to manage changes to the model, by maintaining lists of subscribers who can register interest in changes to different parts of it, and coordinating updates to this component&#39;s model with updates to other component models which are linked to it. It also allows you to add checks that can prevent changes to the model if necessary (e.g validation).</p>
<h2 id="declaring-a-model-component">Declaring a Model Component</h2>
<p>To use a model with your component, you need to use the <code>fluid.modelComponent</code> grade. To do this:</p>
<ul>
<li>specify a grade of <code>fluid.modelComponent</code>, or a grade derived from it (such as <code>fluid.viewComponent</code>, etc.) as part of your component&#39;s parent grades</li>
<li>Optionally, you may include a model property in your defaults holding some initial values suitable for your component&#39;s model</li>
</ul>
<pre class="highlight"><code class="hljs javascript">fluid.defaults(<span class="hljs-string">"tutorials.modelBearingComponent"</span>, {
    gradeNames: [<span class="hljs-string">"fluid.modelComponent"</span>],
    ...
    model: {
        ...
    }
});
</code></pre>
<h2 id="example-currency-converter">Example: Currency Converter</h2>
<p>We can extend our currency converter example from the previous section by storing a set of rates for different currencies in its model, as well a user&#39;s selected currency and its value in original and converted forms:</p>
<pre class="highlight"><code class="hljs javascript">fluid.defaults(<span class="hljs-string">"tutorials.currencyConverter"</span>, {
    gradeNames: <span class="hljs-string">"fluid.modelComponent"</span>,
    model: {
        rates: {
            euro: <span class="hljs-number">0.712</span>,
            yen: <span class="hljs-number">81.841</span>,
            yuan: <span class="hljs-number">6.609</span>,
            usd: <span class="hljs-number">1.02</span>,
            rupee: <span class="hljs-number">45.789</span>
        },
        currentSelection: <span class="hljs-string">"euro"</span>,
        amount: <span class="hljs-number">0</span>,
        convertedAmount: <span class="hljs-number">0</span>
    },
    events: {
        conversionUpdated: <span class="hljs-literal">null</span>
    },
    invokers: {
        updateCurrency: {
            changePath: <span class="hljs-string">"currentSelection"</span>,
            value: <span class="hljs-string">"{arguments}.0"</span>
        },
        updateRate: {
            funcName: <span class="hljs-string">"tutorials.currencyConverter.updateRate"</span>,
            args: [<span class="hljs-string">"{that}"</span>, <span class="hljs-string">"{arguments}.0"</span>, <span class="hljs-string">"{arguments}.1"</span>] <span class="hljs-comment">// currency, newRate</span>
        },
        updateAmount: {
            funcName: <span class="hljs-string">"tutorials.currencyConverter.updateAmount"</span>,
            args: [<span class="hljs-string">"{that}"</span>, <span class="hljs-string">"{arguments}.0"</span>] <span class="hljs-comment">// amount</span>
    },
    modelListeners: {
        convertedAmount: {
            funcName: <span class="hljs-string">"{that}.events.conversionUpdated.fire"</span>,
            args: <span class="hljs-string">"{change}.value"</span>
        }
    }
});

tutorials.currencyConverter.updateRate = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(that, currency, newRate)</span> {</span>
    that.applier.change([<span class="hljs-string">"rates"</span>, currency], newRate);
};

tutorials.currencyConverter.updateAmount = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(that, amount)</span> {</span>
    <span class="hljs-keyword">var</span> convertedAmount = amount * that.model.rates[that.model.currentSelection];
    that.applier.change(<span class="hljs-string">"convertedAmount"</span>, convertedAmount);
};
</code></pre>
<h2 id="contents-of-the-model-and-its-relation-to-other-models">Contents of the model and its relation to other models</h2>
<p>The <code>model</code> record can consist of any JSON material, as well as containing <a href="../IoCReferences.html">IoC references</a> to the models and options of other components, as well as <a href="../ExpansionOfComponentOptions.html">expanders</a>.
Any IoC references to another component&#39;s model will set up a permanent <a href="../ModelRelay.html">model relay</a> between the two models at the endpoints of the reference.
This relay will be bidirectional - any updates propagated into either of the models linked by the relay by their respective ChangeAppliers will be relayed into the model at the other end of the link.</p>
<h2 id="using-the-change-applier">Using The Change Applier</h2>
<p>The Framework will attach both your model and its ChangeApplier to the component object as top-level properties. Your methods can read the model directly, using <code>that.model.&lt;some-path&gt;</code>, but the ChangeApplier should be used to make any changes to the model, using <code>that.applier.change();</code>.</p>
<h2 id="example-dated-component">Example: Dated Component</h2>
<p>As an example, let&#39;s consider a component that need to record a date. Your <code>model</code> will include a date field - if you wished to give it an initial default value of <code>null</code>
(actually this practice is not recommended - it is better to only supply default values which are actually useful in a particular context), it could be initialised as follows:</p>
<pre class="highlight"><code class="hljs javascript">fluid.defaults(<span class="hljs-string">"tutorials.modelBearingComponent"</span>, {
    gradeNames: [<span class="hljs-string">"fluid.modelComponent"</span>],
    ...
    model: {
        date: <span class="hljs-literal">null</span>
    }
});
</code></pre>
<p>Suppose that you want the <code>date</code> initialized to the current date at the time the component is instantiated, and you want this to happen before other component initialization happens.
You can specify an initial value for the <code>date</code> field by use of an IoC facility known as an <a href="../ExpansionOfComponentOptions.html#expanders">expander</a>. This allows you to schedule the action of any function during the initialization process and have the results entered into the component&#39;s configuration.
Our work comes in two parts - firstly, writing a global helper function which returns the current date, named <code>tutorials.getCurrentDate</code>. The second part writes an expander within the model definition to invoke our helper function:</p>
<pre class="highlight"><code class="hljs javascript">tutorials.getCurrentDate = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> {</span>
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>();
 };

fluid.defaults(<span class="hljs-string">"tutorials.datedComponent"</span>, {
    gradeNames: [<span class="hljs-string">"fluid.modelComponent"</span>],
    model: {
        date: {
            expander: {
                funcName: <span class="hljs-string">"tutorials.getCurrentDate"</span>
                }
             }
          }
    }
});
</code></pre>
<div class="infusion-docs-note"><strong>Note:</strong> There is a
<a href="../ExpansionOfComponentOptions.html#compact-format-for-expanders">compact form</a>
for writing an expander as a single string - we could have written the above definition
instead with <code>date: &quot;@expand:tutorials.getCurrentDate()&quot;</code> in place of the small JSON
block inside the model.</div>

<h2 id="example-currency-converter">Example: Currency Converter</h2>
<p>The currency converter example we presented on the previous page might be more helpful if it supported more than one conversion rate. We can use a model to hold the available rates and to keep track of the currently-selected rate. We define this model in the component&#39;s defaults:</p>
<pre class="highlight"><code class="hljs javascript">fluid.defaults(<span class="hljs-string">"tutorials.currencyConverter"</span>, {
    gradeNames: [<span class="hljs-string">"fluid.modelComponent"</span>],
    model: {
        currentSelection: <span class="hljs-string">"euro"</span>,
        rates: {
            euro: <span class="hljs-number">0.712</span>,
            yen: <span class="hljs-number">81.841</span>,
            yuan: <span class="hljs-number">6.609</span>,
            usd: <span class="hljs-number">1.02</span>,
            rupee: <span class="hljs-number">45.789</span>
        }
    },
    invokers: {
        updateCurrency: {
            changePath: <span class="hljs-string">"currentSelection"</span>,
            value: <span class="hljs-string">"{arguments}.0"</span>
        },
        updateRate: {
            funcName: <span class="hljs-string">"tutorials.currencyConverter.updateRate"</span>,
            args: [<span class="hljs-string">"{that}"</span>, <span class="hljs-string">"{arguments}.0"</span>, <span class="hljs-string">"{arguments}.1"</span>] <span class="hljs-comment">// currency, newRate</span>
        },
        convert: {
            funcName: <span class="hljs-string">"tutorials.currencyConverter.convert"</span>,
            args: [<span class="hljs-string">"{that}"</span>, <span class="hljs-string">"{arguments}.0"</span>] <span class="hljs-comment">// amount</span>
        }
    }
});


tutorials.currencyConverter.updateRate = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(that, currency, newRate)</span> {</span>
    that.applier.change([<span class="hljs-string">"rates"</span>, currency], newRate);
};

tutorials.currencyConverter.convert = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(that, amount)</span> {</span>
    <span class="hljs-keyword">return</span> amount * that.model.rates[that.model.currentSelection];
};
</code></pre>
<p>Next: <a href="ViewComponents.html">View Components</a></p>

                        </div>
                    </div>

                    <footer class="row infusion-docs-footer">
                        <p class="infusion-docs-footerInfusion">Infusion is created by the <a href="http://fluidproject.org/" target="_blank">Fluid Project</a>,<br/>
                        a project of the <a href="http://idrc.ocad.ca/" target="_blank">Inclusive Design Research Centre</a> at <a href="http://www.ocadu.ca/" target="_blank">OCAD University</a>, funded by a grant from <a href="http://www.mellon.org/" target="_blank">The Andrew W. Mellon Foundation</a>.</p>
                    </footer>

                </article>

            </div>


        </div> <!-- end container -->
        <script>
            fluid.docs.onLoad();
        </script>

    </body>

</html>
